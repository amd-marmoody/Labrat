# ============================================================================
# LabRat tmux Configuration
# Your trusty environment for every test cage ðŸ€
# ============================================================================

# ----------------------------------------------------------------------------
# General Settings
# ----------------------------------------------------------------------------

# Enable mouse support (scrolling, pane selection, resizing)
set -g mouse on

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Increase scrollback buffer size
set -g history-limit 50000

# Display tmux messages for 4 seconds
set -g display-time 4000

# Refresh status bar more often
set -g status-interval 5

# Focus events for vim/neovim
set -g focus-events on

# Faster command sequences (reduce escape time)
set -s escape-time 10

# Enable 256 colors and true color support
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"

# Aggressive resize (useful for grouped sessions)
setw -g aggressive-resize on

# Status bar position
set -g status-position bottom
set -g status-left-length 100
set -g status-right-length 150

# ----------------------------------------------------------------------------
# Key Bindings
# ----------------------------------------------------------------------------

# Reload config
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Split panes using | and -
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind '"' split-window -v -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

# New window in current path
bind c new-window -c "#{pane_current_path}"

# Vim-style pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Alt + arrow keys to switch panes (without prefix)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Ctrl + Shift + arrow to switch windows
bind -n C-S-Left previous-window
bind -n C-S-Right next-window

# Pane resizing with Prefix + Ctrl + hjkl
bind -r C-h resize-pane -L 5
bind -r C-j resize-pane -D 5
bind -r C-k resize-pane -U 5
bind -r C-l resize-pane -R 5

# Maximize/restore pane (toggle zoom)
bind z resize-pane -Z

# Quick window switching
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# Scratchpad / popup terminal (tmux 3.2+)
bind -n M-g display-popup -E -w 80% -h 80% "tmux new-session -A -s scratch"
bind -n M-t display-popup -E -w 80% -h 80%

# Session management
bind S command-prompt -p "New session name:" "new-session -s '%%'"
bind K confirm-before -p "Kill session #S? (y/n)" kill-session

# Theme switcher key binding (Prefix + T)
bind T run-shell "~/.local/bin/tmux-theme"

# ----------------------------------------------------------------------------
# Copy Mode (Vi-style)
# ----------------------------------------------------------------------------

# Use vi keys in copy mode
setw -g mode-keys vi

# Enter copy mode with Prefix + [
bind [ copy-mode

# Vi-style selection and copy
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi r send-keys -X rectangle-toggle

# Copy to system clipboard (requires xclip or xsel)
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -selection clipboard -i 2>/dev/null || xsel -ib"

# Mouse selection copies to clipboard
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -selection clipboard -i 2>/dev/null || xsel -ib"

# Paste with Prefix + p
bind p paste-buffer

# ----------------------------------------------------------------------------
# Plugins (managed by TPM)
# ----------------------------------------------------------------------------

# Core plugins (always enabled)
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-pain-control'

# ----------------------------------------------------------------------------
# Theme Plugin Configuration
# 
# Available themes (set via ~/.tmux-theme file):
#   - catppuccin-mocha (default)
#   - catppuccin-latte
#   - tokyo-night
#   - dracula
#   - nord
#   - gruvbox
#   - minimal (no theme plugin, basic colors)
# ----------------------------------------------------------------------------

# Catppuccin Theme Plugin (https://github.com/catppuccin/tmux)
set -g @plugin 'catppuccin/tmux'
set -g @catppuccin_flavor 'mocha' # latte, frappe, macchiato, mocha
set -g @catppuccin_window_status_style "rounded"
set -g @catppuccin_window_number_position "left"
set -g @catppuccin_window_default_fill "number"
set -g @catppuccin_window_default_text "#W"
set -g @catppuccin_window_current_fill "number"
set -g @catppuccin_window_current_text "#W"
set -g @catppuccin_status_modules_right "directory session date_time"
set -g @catppuccin_status_left_separator "â–ˆ"
set -g @catppuccin_status_right_separator "â–ˆ"
set -g @catppuccin_date_time_text "%Y-%m-%d %H:%M"
set -g @catppuccin_directory_text "#{pane_current_path}"

# Tokyo Night Theme Plugin (https://github.com/janoamaral/tokyo-night-tmux)
# Uncomment to use Tokyo Night instead of Catppuccin
# set -g @plugin 'janoamaral/tokyo-night-tmux'
# set -g @tokyo-night-tmux_show_datetime 1
# set -g @tokyo-night-tmux_date_format MYD
# set -g @tokyo-night-tmux_time_format 24H
# set -g @tokyo-night-tmux_show_path 1
# set -g @tokyo-night-tmux_path_format relative
# set -g @tokyo-night-tmux_show_git 1
# set -g @tokyo-night-tmux_show_battery_widget 1
# set -g @tokyo-night-tmux_show_netspeed 0

# Dracula Theme Plugin (https://github.com/dracula/tmux)
# Uncomment to use Dracula instead
# set -g @plugin 'dracula/tmux'
# set -g @dracula-plugins "git battery weather time"
# set -g @dracula-show-powerline true
# set -g @dracula-show-left-icon session
# set -g @dracula-military-time true
# set -g @dracula-show-timezone false

# Nord Theme Plugin (https://github.com/nordtheme/tmux)
# Uncomment to use Nord instead
# set -g @plugin 'nordtheme/tmux'

# Gruvbox Theme (https://github.com/egel/tmux-gruvbox)
# Uncomment to use Gruvbox instead
# set -g @plugin 'egel/tmux-gruvbox'
# set -g @tmux-gruvbox 'dark' # dark or light

# ----------------------------------------------------------------------------
# Plugin Settings
# ----------------------------------------------------------------------------

# tmux-resurrect: save/restore sessions
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'

# tmux-continuum: auto save/restore
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# tmux-yank: clipboard integration
set -g @yank_selection_mouse 'clipboard'

# ----------------------------------------------------------------------------
# Initialize TPM (keep this line at the very bottom)
# ----------------------------------------------------------------------------
run '~/.tmux/plugins/tpm/tpm'
